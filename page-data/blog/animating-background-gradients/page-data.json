{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/animating-background-gradients/","result":{"data":{"markdownRemark":{"excerpt":"I wanted to spice the page up a bit and might have gone wholly overboard with this. My hope was that I could introduce some elevation cards, pretty much found…","html":"<p>I wanted to spice the page up a bit and might have gone wholly overboard with this.</p>\n<p>My hope was that I could introduce some elevation cards, pretty much found everywhere as part of flat/material design. Sadly my white on white background was a bit boring.<br>\nIndecisive as I am, I thought: “Why not try a gradient? That’d let me pick multiple colors I might want!”, that turned into: “I’ve seen animated gradients… I should do that.”, which then quickly became: “I don’t know what colors work! I’ll just randomize it… I guess?“.</p>\n<p>Like so often, that idea seemed a lot better in my head, than the actual result as it turned out. But first things first.</p>\n<p>I wanted my gradient to be easy to use and be globally available. As I’m using React with Gatsby, I wanted the result to be a oneliner and have it as declarative as possible, and also with the chance to easily improve upon in the future.<br>\nIf you’ve thought to yourself: “That’s pretty on the nose for a component!”, then you’re right.</p>\n<p>My usage is simply the following line, added to my layout component:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>Themer <span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>This currently is a component, that doesn’t take any props (including children) and also doesnt render anything out.</p>\n<p>Due to the fact that the <code class=\"language-text\">ReactDOM.render()</code> from <code class=\"language-text\">react-dom</code> here in use by the Gatsby, doesn’t attach to the <code class=\"language-text\">&lt;html&gt;</code> root tag and also probably shouldn’t, I wanted to break out of the attached context and attach the gradient style to the DOM outside of my React context.</p>\n<p>On the one hand, that’s a pretty bad idea, since it’s not managed from React and I’m basically setting stuff outside my scope, because I can. Doing so is in total disregard of what might already be there and who or what else uses that attribute. On the other hand, it also opens up another possibility: state persistence across renders, without having to muck with the Gatsby setup. So far I’m reshuffling the gradient on every rerender, but I might want to keep it across renders and since it’s not part of the React render, that also means it’s not prone to flickering during.</p>\n<p>Let’s look at the code. The Themer component itself is pretty small too. While the original code was pretty concise, this is way more readable.</p>\n<p>As we’re not really going to render anything new directly using this component, but only modify existing DOM, this component doesn’t need React per se. Here we’re using the <code class=\"language-text\">useEffect</code> hook so that we can run the update function on rerenders.<br>\nIf we are going to use hooks, context or JSX for example, we need to import React. Reacts functional components are by definition just plain functions, if we wanted to schedule a background resizing differently or didn’t care about the background size, we could do without the import.<br>\nThemer runs, modifies and returns <code class=\"language-text\">null</code> for React to render - nothing.<br>\nThe query and modification of the :root style is wrapped in a conditional, so that the code doesn’t run during Gatsby compile-time. If it wasn’t it would throw an undefined.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Themer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> gradientRotation <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">randomColor</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">'#'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token number\">0xffffff</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">padStart</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> randomGradientLength <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> gradientColors <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>length<span class=\"token operator\">:</span> randomGradientLength<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> randomColor<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">update</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">':root'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> scaledMaxDimension <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">.</span>offsetHeight<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">.</span>offsetWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">2</span>\n    <span class=\"token keyword\">const</span> gradient <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">linear-gradient(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gradientRotation<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">deg,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>gradientColors<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) 0 0 / </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>maxDimension<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>maxDimension<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span>\n\n    root<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">[</span><span class=\"token string\">'background'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> gradient\n  <span class=\"token punctuation\">}</span>\n\n  React<span class=\"token punctuation\">.</span><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Themer</code></pre></div>\n<p>First the <code class=\"language-text\">linear-gradient</code> takes a rotation value. We could’ve put any deg value, but decided to get a random integer between zero and 360, appending deg. The rest of the arguments passed to the gradient are the gradient colors.</p>\n<p>The part that tripped me up was my #RGB-value creating <code class=\"language-text\">randomColor()</code> function, which at first didn’t have the zero-padding of the generated String.<br>\nIf the random value was too low the #RGB-value was of invalid length. It didn’t happen too often, but of course still more than enough, leaving the background white. The string (excluding the #) is allowed to be either three or six hex-characters of <code class=\"language-text\">[0-9a-f]</code> long, but could be anywhere between one or six without the padding.<br>\nThinking about #RGB as one long hex-value, creating the hex is easier calculated, than looping through the allowed alphabet and concatenating the characters to a string. We create a decimal from zero to 0xffffff which corresponds to 16777215, floor it to an integer, then convert it to a base 16 string and zero-pad if it’s too short, then finally concat it with # to get a valid #RGB-value.</p>\n<p>The animation isn’t too interesting, but luckily a moving gradient can be done in pure CSS. The gradient itself might not be animated, but we’re setting a background larger than the viewport and move the background-position. In this case we’ve made the background a square with the sides as long as the largest px-value of rendered content.<br>\n<code class=\"language-text\">background</code> is shorthand for multiple background properties. After the background-color definition of linear-gradient there is a background-position and then delimited by / the background-size, written as <code class=\"language-text\">0 0 / ${maxDimension}px ${maxDimension}px</code>.</p>\n<p>What is left is creating the keyframes and attaching them using CSS.</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> animatedBackgroundGradient 30s ease alternate infinite<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> animatedBackgroundGradient</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token selector\">0%</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 0% 0%<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token selector\">25%</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 0% 50%<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token selector\">50%</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 100% 0%<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token selector\">75%</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 100% 50%<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token selector\">100%</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 0% 0%<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>All in all this results in some pretty, some very unnoticable, but also some pretty ugly color combinations. It’s a hit or miss.<br>\nTo improve on this, there’s a lot of thinking about actual color theory, color representation and then animation left to do. The hard cutoffs need to go, same as weird color combinations and generally picking some muddy colors. For now it just runs.<br>\nSadly this also means <em>“it just runs”</em>. You can’t turn it off and you can’t guarantee, that it doesn’t bug people out.</p>\n<p>Since this is my first real blog post, it’ll do for now and I’ll get back to it later. Once I change the setup, I’ll reference the hash of the git repo here. I might also add some media.</p>","tableOfContents":"","frontmatter":{"title":"Animated random background gradients","date":"October 16, 2019","tags":["CSS","JS","Frontend","Web"],"description":"Adding a first simple animated background to this page has been surprisingly simple. Using a keyframe and CSS gradient, this was fairly easy to integrate."}}},"pageContext":{"slug":"/animating-background-gradients/","previous":{"fields":{"slug":"/under-construction/"},"frontmatter":{"title":"WIP - This page is under construction!"}},"next":{"fields":{"slug":"/javascript-destructuring/"},"frontmatter":{"title":"JavaScript destructuring"}}}},"staticQueryHashes":["2880777621","63159454"]}